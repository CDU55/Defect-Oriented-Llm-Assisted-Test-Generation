# Defect-Oriented-Llm-Assisted-Test-Generation

This repository contains the artifacts for an empirical study on how well large language models (LLMs) generate Solidity unit tests from test templates. It includes input contracts, test templates, generated outputs, and experimental results.

## Repository Structure

This repository is organized into the following main directories:

### Experiment Directory
The core folder for the LLM generation study using the primary dataset.

* **`Experiment/Input/`**: Contains the data fed into the LLMs.
    * **`Contracts/`**: Source code for target smart contracts (`.sol`). Each file represents a specific vulnerability class (e.g., `Reentrancy.sol`, `Division By Zero.sol`).
    * **`Templates_MultiShot/`**: Foundry/Kontrol test templates (`.t.sol`) designed for the "Multi-Shot" prompting strategy.
    * **`Templates_ZeroShot/`**: Foundry/Kontrol test templates (`.t.sol`) designed for the "Zero-Shot" prompting strategy.

* **`Experiment/Output/`**: Contains the raw artifacts generated by the models.
    * **`Multi-Shot/`**: Foundry/Kontrol test files generated using the multi-shot strategy.
    * **`Zero-Shot/`**: Foundry/Kontrol test files generated using the zero-shot strategy.
    * **`Examples/`**: Manually implemented tests, which served as the correct reference implementation for our analysis.

### SmartBugs-Experiment Directory
This directory contains an extension of the study applied to the **SmartBugs dataset**, organized by vulnerability category.

* **`SmartBugs-Experiment/Input/Contracts/`**: Source contracts from the SmartBugs dataset, categorized by vulnerability type:
    * `Predictable Random Number Generation/`
    * `Reentrancy/`
    * `Unrestricted Access to a Critical Method/`

* **`SmartBugs-Experiment/Output/`**: Generated test artifacts for the SmartBugs dataset.
    * **`Zero-Shot/Temperature_0/Gemini-3-Pro/`**: Foundry/Kontrol test files (`.t.sol`) generated by Gemini 3 Pro using zero-shot prompting, mirroring the input category structure.

## Models Evaluated

The following Large Language Models (LLMs) were evaluated in this study:

* **GPT 5.1**
* **Gemini 3 Pro**
* **Codestral**
* **Claude Opus 4.5**
* **DeepSeek-V 3.2**
* **Grok-4**

## Experiment Prompt

The following prompt template was used to generate tests for each vulnerability.

> You are an expert Smart Contract Security Engineer and SDET specialized in the Foundry/Forge framework.
>
> Your task is to generate a Solidity test file that reproduces a specific vulnerability in a given contract.
> I will provide the Defect Definition, the Target Contract, and a Test Template.
>
> **Instructions**
>
> Analyze the [TARGET_CONTRACT] contract to identify the [METHOD_NAME] and its dependencies.
>
> Using the template, fill in the logic required to prove the existence of [ISSUE_NAME].
>
> **Strict Output Format:** Return ONLY the Solidity code within Markdown code blocks. Do not provide explanations, introductions, or conclusions.
>
> **Comment Handling:**
>
> Delete all comments starting with // [LLM_INSTRUCTION] or similar template markers from the final output.
>
> The generated code should be clean and ready to compile, containing only the necessary logic and standard Solidity comments (like SPDX licenses or logic explanations).
>
> **Input Data**
>
> Issue Name: [ISSUE_NAME]
> Defect Definition: [DEFECT_DEFINITION]
> Method to Test: [METHOD_NAME]
>
> **Target Contract:**
>
> [CONTRACT_CODE]
>
>
> **Test Template:**
>
> [TEST_TEMPLATE]

### Token Definitions

The placeholders enclosed in square brackets were replaced programmatically as follows:

* **`[ISSUE_NAME]`**: A placeholder for the type of vulnerability that the test aims to demonstrate.
* **`[DEFECT_DEFINITION]`**: A brief explanation of the issue, intended to provide more context to the model.
* **`[METHOD_NAME]`**: The method from the contract being targeted for test generation.
* **`[TARGET_CONTRACT]`**: The name of the contract being targeted for test generation.
* **`[CONTRACT_CODE]`**: The source code of the smart contract under test.
* **`[TEST_TEMPLATE]`**: The test template implemented for the specific issue to be detected.